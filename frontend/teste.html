<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste MyWallet API</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #4f46e5; }
        .card {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover { background: #4338ca; }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
        button.success { background: #10b981; }
        button.success:hover { background: #059669; }
        #result {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status { 
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.ok { background: #10b981; color: white; }
        .status.error { background: #ef4444; color: white; }
    </style>
</head>
<body>
    <h1>üß™ Teste MyWallet API</h1>
    
    <div class="card">
        <h2>1Ô∏è‚É£ Popular Banco de Dados</h2>
        <p>Cria usu√°rio, categorias e transa√ß√µes de exemplo</p>
        <button onclick="seedDatabase()" class="success">‚ñ∂ Popular Banco</button>
        <button onclick="clearDatabase()" class="danger">üóëÔ∏è Limpar Banco</button>
    </div>

    <div class="card">
        <h2>2Ô∏è‚É£ Testar Endpoints</h2>
        <button onclick="testEndpoint('/api/Users')">GET /api/Users</button>
        <button onclick="testEndpoint('/api/Categories')">GET /api/Categories</button>
        <button onclick="testEndpoint('/api/Transactions')">GET /api/Transactions</button>
        <button onclick="testEndpoint('/api/Dashboard')">GET /api/Dashboard</button>
    </div>

    <div class="card">
        <h2>3Ô∏è‚É£ Criar Nova Transa√ß√£o</h2>
        <button onclick="createTransaction()">POST Nova Transa√ß√£o</button>
    </div>

    <div class="card">
        <h2>üìä Resultado</h2>
        <div id="result">Aguardando teste...</div>
    </div>

    <script>
        const API_URL = 'http://localhost:5296';
        const resultDiv = document.getElementById('result');

        function log(message, isError = false) {
            const timestamp = new Date().toLocaleTimeString();
            const status = isError ? '‚ùå' : '‚úÖ';
            resultDiv.innerHTML = `[${timestamp}] ${status} ${message}\n\n${resultDiv.innerHTML}`;
        }

        async function seedDatabase() {
            try {
                log('Populando banco de dados...');
                const response = await fetch(`${API_URL}/api/Seed`);
                const data = await response.json();
                log(`Seed Response:\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Erro: ${error.message}`, true);
            }
        }

        async function clearDatabase() {
            if (!confirm('‚ö†Ô∏è Tem certeza? Isso apagar√° TODOS os dados!')) return;
            
            try {
                log('Limpando banco de dados...');
                const response = await fetch(`${API_URL}/api/Seed`, { method: 'DELETE' });
                const data = await response.json();
                log(`Clear Response:\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Erro: ${error.message}`, true);
            }
        }

        async function testEndpoint(endpoint) {
            try {
                log(`Testando ${endpoint}...`);
                const response = await fetch(`${API_URL}${endpoint}`);
                const data = await response.json();
                log(`Response ${endpoint}:\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Erro em ${endpoint}: ${error.message}`, true);
            }
        }

        async function createTransaction() {
            try {
                const transaction = {
                    description: "Teste via HTML",
                    amount: 99.99,
                    date: new Date().toISOString().split('T')[0],
                    type: 2, // Expense
                    categoryId: "44444444-4444-4444-4444-444444444444", // Alimenta√ß√£o
                    userId: "11111111-1111-1111-1111-111111111111"
                };

                log('Criando nova transa√ß√£o...');
                const response = await fetch(`${API_URL}/api/Transactions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(transaction)
                });

                const data = await response.json();
                log(`Transaction Created:\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Erro ao criar transa√ß√£o: ${error.message}`, true);
            }
        }

        // Teste inicial de conex√£o
        window.onload = async () => {
            try {
                const response = await fetch(`${API_URL}/api/Users`);
                if (response.ok) {
                    log('‚úÖ API est√° online e respondendo!');
                } else {
                    log('‚ö†Ô∏è API respondeu mas com erro', true);
                }
            } catch (error) {
                log(`‚ùå N√£o foi poss√≠vel conectar na API!\nVerifique se o backend est√° rodando em ${API_URL}`, true);
            }
        };
    </script>
</body>
</html>
